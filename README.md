# Virtual-Malware-Analysis-Lab

## Objective
My objective is to create a secure and controlled environment for testing and analyzing 
malware using virtual machines to identify and understand indicators of compromise.

### Skills Learned
- I learnt how to create and configure Virtual Machines using VirtualBox in Windows 10 and Kali Linux VMs.
  Also the ability to segment networks to prevent the spread of malware to the host machine or other machines on the 
  network through static IP assignment within VirtualBox.
- I am now familiar with creating snapshots of virtual machines to create restore points, allowing for safe 
  experimentation and rollback if necessary.
- Basic understanding of how to build custom malware using tools like msfvenom with specific payloads (e.g., Meterpreter 
  reverse TCP) and ability to execute it in a controlled environment.
- Continued experience in configuring Sysmon for Windows event logging and setting up Splunk to ingest and analyze 
  Sysmon data and i understand how to set up detections based on this data.
- Build up skills in using Windows Task Manager and command line tools like netstat to monitor active connections and 
  processes.
- Also the ability to search and analyze event codes and process relationships in Splunk to understand malware behavior.
- Gained knowledge of how to create alerts based on telemetry data to detect and respond to future instances of similar 
  activities.

### Tools Used
<div>
<img src="https://img.shields.io/badge/-VirtualBox-E85C0D?&style=for-the-badge&logo=VirtualBox&logoColor=white" alt="VirtualBox">
<img src="https://img.shields.io/badge/-Kali%20Linux-FFEB00?&style=for-the-badge&logo=kali-linux&logoColor=white" alt="Kali Linux">
<img src="https://img.shields.io/badge/-Sysmon-825B32?&style=for-the-badge&logo=windows&logoColor=white" alt="Sysmon">
<img src="https://img.shields.io/badge/-Metasploit%20Framework-821131?&style=for-the-badge&logo=metasploit&logoColor=white" alt="Metasploit Framework">
<img src="https://img.shields.io/badge/-Python%20HTTP%20Server-00712D?&style=for-the-badge&logo=python&logoColor=white" alt="Python HTTP Server">
<img src="https://img.shields.io/badge/-Nmap-2E236C?&style=for-the-badge&logo=nmap&logoColor=white" alt="Nmap">
</div>

## Steps
- I first established a sandboxed environment using VirtualBox with Windows 10 and Kali Linux as 
  virtual machines (VMs) to test malware safely without impacting your production system.

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/a0f3edadb0f52cdf430d36ad88db3f38ce9d3637/Images/sandboxing.PNG" width="700" />
</p>
  
- I properly configured both VMs to prevent malware from spreading to host machines or other network devices.
  This includes setting up internal networks, static IP addresses, and ensuring no external internet or LAN access.

<p align="center">
  <img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/a0f3edadb0f52cdf430d36ad88db3f38ce9d3637/Images/IPv4%20settings%20Windows.PNG" width="300" />
  <img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/f27b3135ec321a5615146d69352d69ed2679493e/Images/IPv4%20settings%20Kali.PNG" width="300" />
</p>
  
- I set up network configurations for communication between VMs, ensuring proper rules and permissions for testing. 
- I created snapshots of VMs before running tests to allow easy restoration to a clean state should the malware
  crash my VM.

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/1d4370d3cc9cecb374e1e5a00b9838980fb4e40e/Images/Snapshot%20Kali.PNG" width="700" />
</p>
  
- I began by developing our malware by using the Meterpreter reverse shell as our payload.

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/1d4370d3cc9cecb374e1e5a00b9838980fb4e40e/Images/msfvenom%20-l%20payloads.PNG" width="700" />
</p>
  
- I utilize tools such as Metasploit for payload creation, and configure HTTP servers for delivering malware to my
  windows 10 test machine.

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/1d4370d3cc9cecb374e1e5a00b9838980fb4e40e/Images/msfvenom.PNG" width="700" />
</p>

- I changed the payload options such as lhost IP address and executed and test malware within this controlled
  environment to observe its behavior and collect telemetry. 

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/1d4370d3cc9cecb374e1e5a00b9838980fb4e40e/Images/our%20payload%20options%20have%20changed.PNG" width="700" />
</p>
  
I went to our test environment in windows 10, disabled the antivirus, downloaded the executable using our kali Linux IP 
address and port. I run the program and used tools like Sysmon and Splunk to gather and analyze data.

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/1d4370d3cc9cecb374e1e5a00b9838980fb4e40e/Images/our%20executable.PNG" width="700" />
</p>
 
- I collected telemetry data from Sysmon through Splunk to identify malicious behavior and develop detection
  rules to alert on similar activities in the future.

<p align="center">
<img src="https://github.com/NgethaWachira/Virtual-Malware-Analysis-Lab/blob/1d4370d3cc9cecb374e1e5a00b9838980fb4e40e/Images/querying%20malware.PNG" width="700" />
</p>
